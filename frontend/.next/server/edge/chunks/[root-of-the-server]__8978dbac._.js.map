{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/middleware.ts"],"sourcesContent":["import { createServerClient } from \"@supabase/ssr\";\r\nimport { NextRequest, NextResponse } from \"next/server\";\r\n\r\nexport async function middleware(req: NextRequest) {\r\n  let response = NextResponse.next();\r\n\r\n const supabase = createServerClient(\r\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\r\n    {\r\n       cookies: {\r\n        getAll() {\r\n          return req.cookies.getAll()\r\n        },\r\n        setAll(cookiesToSet) {\r\n          cookiesToSet.forEach(({ name, value, options }) => req.cookies.set(name, value))\r\n          response = NextResponse.next({\r\n            request: req,\r\n          })\r\n          cookiesToSet.forEach(({ name, value, options }) =>\r\n            response.cookies.set(name, value, options)\r\n          )\r\n        },\r\n      }\r\n    }\r\n  );\r\n  \r\n  const {\r\n    data: { user },\r\n    error,\r\n  } = await supabase.auth.getUser();\r\n  \r\n  const protectedRoutes = [\r\n    \"/kami\",\r\n    \"/kami/upload\",\r\n    \"/kami/upload/anime\",\r\n    \"/kami/upload/anime/episode\",\r\n  ];\r\n  const isProtectedRoute = protectedRoutes.some((route) =>\r\n    req.nextUrl.pathname.startsWith(route)\r\n  );\r\n\r\n  if (isProtectedRoute && !user) {\r\n    return NextResponse.redirect(new URL(\"/auth/login\", req.nextUrl.origin));\r\n  }\r\n\r\n  const authRoutes = [\"/auth/login\", \"/auth/signup\"];\r\n  const isAuthRoute = authRoutes.some((route) =>\r\n    req.nextUrl.pathname.startsWith(route)\r\n  );\r\n\r\n if (isAuthRoute && user) {\r\n    const role = user.user_metadata?.role; \r\n    console.log(role)\r\n    return NextResponse.redirect(\r\n      new URL(role === \"kami\" ? \"/kami/upload/anime\" : \"/home\", req.nextUrl.origin)\r\n    );\r\n  }\r\n\r\nif (user && user.user_metadata?.role === \"kami\" && req.nextUrl.pathname === \"/home\") {\r\n    return NextResponse.redirect(new URL(\"/kami/upload/anime\", req.nextUrl.origin));\r\n  }\r\n\r\nif (user && user.user_metadata?.role === \"user\" && isProtectedRoute) {\r\n    return NextResponse.redirect(new URL(\"/home\", req.nextUrl.origin));\r\n  }\r\n\r\n  return response;\r\n}\r\n\r\nexport const config = {\r\n  matcher: [\"/auth/:path*\", \"/kami/:path*\", \"/home\"],\r\n};\r\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;AACA;AAAA;;;AAEO,eAAe,WAAW,GAAgB;IAC/C,IAAI,WAAW,gMAAY,CAAC,IAAI;IAEjC,MAAM,WAAW,IAAA,uMAAkB,sUAGhC;QACG,SAAS;YACR;gBACE,OAAO,IAAI,OAAO,CAAC,MAAM;YAC3B;YACA,QAAO,YAAY;gBACjB,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE,GAAK,IAAI,OAAO,CAAC,GAAG,CAAC,MAAM;gBACzE,WAAW,gMAAY,CAAC,IAAI,CAAC;oBAC3B,SAAS;gBACX;gBACA,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE,GAC5C,SAAS,OAAO,CAAC,GAAG,CAAC,MAAM,OAAO;YAEtC;QACF;IACF;IAGF,MAAM,EACJ,MAAM,EAAE,IAAI,EAAE,EACd,KAAK,EACN,GAAG,MAAM,SAAS,IAAI,CAAC,OAAO;IAE/B,MAAM,kBAAkB;QACtB;QACA;QACA;QACA;KACD;IACD,MAAM,mBAAmB,gBAAgB,IAAI,CAAC,CAAC,QAC7C,IAAI,OAAO,CAAC,QAAQ,CAAC,UAAU,CAAC;IAGlC,IAAI,oBAAoB,CAAC,MAAM;QAC7B,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,eAAe,IAAI,OAAO,CAAC,MAAM;IACxE;IAEA,MAAM,aAAa;QAAC;QAAe;KAAe;IAClD,MAAM,cAAc,WAAW,IAAI,CAAC,CAAC,QACnC,IAAI,OAAO,CAAC,QAAQ,CAAC,UAAU,CAAC;IAGnC,IAAI,eAAe,MAAM;QACtB,MAAM,OAAO,KAAK,aAAa,EAAE;QACjC,QAAQ,GAAG,CAAC;QACZ,OAAO,gMAAY,CAAC,QAAQ,CAC1B,IAAI,IAAI,SAAS,SAAS,uBAAuB,SAAS,IAAI,OAAO,CAAC,MAAM;IAEhF;IAEF,IAAI,QAAQ,KAAK,aAAa,EAAE,SAAS,UAAU,IAAI,OAAO,CAAC,QAAQ,KAAK,SAAS;QACjF,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,sBAAsB,IAAI,OAAO,CAAC,MAAM;IAC/E;IAEF,IAAI,QAAQ,KAAK,aAAa,EAAE,SAAS,UAAU,kBAAkB;QACjE,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,SAAS,IAAI,OAAO,CAAC,MAAM;IAClE;IAEA,OAAO;AACT;AAEO,MAAM,SAAS;IACpB,SAAS;QAAC;QAAgB;QAAgB;KAAQ;AACpD"}}]
}